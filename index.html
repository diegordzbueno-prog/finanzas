<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0B0D14">
    <title>DiegoFi - Control Negocio</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        :root{--bg:#0B0D14;--card:#13151E;--input:#1A1D27;--bdr:#1E2030;--bdr2:#2A2D3A;--t1:#F1F5F9;--t2:#E2E8F0;--t3:#CBD5E1;--t4:#94A3B8;--t5:#64748B;--t6:#475569;--ac:#22D3EE;--pu:#818CF8;--gn:#34D399;--rd:#FF6B6B;--yw:#FBBF24;--or:#FB923C}
        html,body{height:100%;background:var(--bg);font-family:'DM Sans',sans-serif;color:var(--t2);overflow-x:hidden}
        .hdr{padding:14px 16px;position:sticky;top:0;z-index:100;background:var(--bg)}
        .logo span{background:linear-gradient(135deg,var(--ac),var(--pu));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;font-size:22px}
        .cnt{padding:0 14px 90px}
        .cd{background:var(--card);border-radius:14px;padding:16px;border:1px solid var(--bdr);margin-bottom:10px}
        .ct{font-size:12px;color:var(--t4);margin-bottom:10px;font-weight:700;display:flex;justify-content:space-between}
        .sg{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px}
        .sc{background:var(--card);border-radius:14px;padding:12px;border:1px solid var(--bdr);text-align:center}
        .sl{font-size:10px;color:var(--t5);margin-bottom:4px}
        .sv{font-size:14px;font-weight:700}
        .nav{position:fixed;bottom:0;left:0;right:0;height:70px;background:var(--card);display:flex;align-items:center;justify-content:space-around;border-top:1px solid var(--bdr);z-index:1000}
        .nb{background:none;border:none;color:var(--t6);display:flex;flex-direction:column;align-items:center;font-size:10px;font-weight:600}
        .nb.on{color:var(--ac)}
        .ni{font-size:20px;margin-bottom:2px}
        .fab{width:48px;height:48px;border-radius:14px;background:linear-gradient(135deg,var(--ac),var(--pu));color:#fff;font-size:26px;border:none;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(34,211,238,0.3)}
        .gdb{display:flex;align-items:center;gap:8px;margin-top:8px;padding:8px 12px;border-radius:9px;background:var(--input);font-size:11px;cursor:pointer}
        .gdd{width:8px;height:8px;border-radius:50%}.gdd.on{background:var(--gn)}.gdd.off{background:var(--rd)}
        .rep-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--bdr2);font-size:13px}
        .mo{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;align-items:flex-end;z-index:2000}
        .mbox{background:var(--card);width:100%;padding:24px;border-radius:20px 20px 0 0;max-height:90vh;overflow-y:auto}
        .inp{width:100%;padding:12px;background:var(--input);border:1px solid var(--bdr2);border-radius:10px;color:#fff;margin-bottom:10px;outline:none}
        .btn-s{width:100%;padding:14px;border-radius:10px;border:none;font-weight:700;background:var(--ac);color:var(--bg)}
    </style>
</head>
<body>
    <div id="app"></div>

<script>
// --- CONFIGURACIÃ“N ---
const GC = '1029204241098-s89a2jdmfjfbcmev4qgped8phnh971n2.apps.googleusercontent.com';
const DF = 'diegofi_data.json';
const DS = 'https://www.googleapis.com/auth/drive.file';
const CU = {MXN:{s:'$',f:'ðŸ‡²ðŸ‡½'}, USD:{s:'$',f:'ðŸ‡ºðŸ‡¸'}};
const FL = {weekly:'Semanal', biweekly:'Quincenal', monthly:'Mensual'};

let S = {
    transactions: [],
    categories: {
        expense: [
            {id:'pollo_compra',name:'Compra Pollo',icon:'ðŸ—',color:'#FB923C'},
            {id:'food',name:'Comida',icon:'ðŸ”',color:'#FF6B6B'},
            {id:'services',name:'Servicios',icon:'ðŸ’¡',color:'#FBBF24'},
            {id:'other',name:'Otros',icon:'ðŸ“¦',color:'#94A3B8'}
        ],
        income: [
            {id:'pollo_venta',name:'Venta Pollo',icon:'ðŸ’°',color:'#34D399'},
            {id:'trading',name:'Trading',icon:'ðŸ“ˆ',color:'#818CF8'},
            {id:'salary',name:'Otros',icon:'ðŸ’µ',color:'#CBD5E1'}
        ]
    },
    recurring: [],
    view: 'dashboard',
    month: new Date().getMonth(),
    year: new Date().getFullYear(),
    cur: 'MXN',
    modal: null,
    gd: {ok: false, at: null, fid: null, sy: false}
};

// --- DRIVE ---
async function iGD(){
    if(!window.google) return;
    S.gd.tc = google.accounts.oauth2.initTokenRequest({
        client_id: GC, scope: DS, callback: async (r) => {
            S.gd.at = r.access_token; S.gd.ok = true; R(); await fFile(); await ldDr(); R();
        }
    });
}
async function fFile(){
    const r = await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${DF}'`, {headers:{'Authorization':`Bearer ${S.gd.at}`}});
    const d = await r.json();
    if(d.files?.length) S.gd.fid = d.files[0].id;
}
async function ldDr(){
    if(!S.gd.fid) return;
    const r = await fetch(`https://www.googleapis.com/drive/v3/files/${S.gd.fid}?alt=media`, {headers:{'Authorization':`Bearer ${S.gd.at}`}});
    const d = await r.json();
    if(d) { S.transactions = d.transactions || []; S.recurring = d.recurring || []; }
}
async function svDr(){
    if(!S.gd.fid) return;
    await fetch(`https://www.googleapis.
