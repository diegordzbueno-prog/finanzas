<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>DiegoFi Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        :root{--bg:#0B0D14;--card:#13151E;--input:#1A1D27;--bdr:#1E2030;--t1:#F1F5F9;--t5:#64748B;--ac:#22D3EE;--gn:#34D399;--rd:#FF6B6B}
        body{background:var(--bg);font-family:'DM Sans',sans-serif;color:var(--t1);margin:0;display:flex;flex-direction:column;height:100vh}
        #app{flex:1;display:flex;flex-direction:column;padding:16px;overflow-y:auto}
        .loading-screen{display:flex;justify-content:center;align-items:center;height:100vh;color:var(--ac);font-weight:bold}
        .hdr{display:flex;justify-content:space-between;align-items:center;padding:10px 0;margin-bottom:20px}
        .logo{font-size:22px;font-weight:800;color:var(--ac)}
        .cd{background:var(--card);border-radius:16px;padding:16px;border:1px solid var(--bdr);margin-bottom:12px}
        .nav{height:70px;background:var(--card);display:flex;justify-content:space-around;align-items:center;border-top:1px solid var(--bdr)}
        .nb{background:none;border:none;color:var(--t5);font-size:12px;font-weight:600}
        .nb.on{color:var(--ac)}
        .btn-sync{padding:8px 12px;border-radius:8px;background:var(--input);border:1px solid var(--bdr);color:var(--t1);font-size:12px;cursor:pointer}
    </style>
</head>
<body>
    <div id="app">
        <div class="loading-screen">Iniciando DiegoFi...</div>
    </div>

    <script src="https://accounts.google.com/gsi/client" onload="googleLoaded = true" async defer></script>

<script>
let googleLoaded = false;
const GC = '1029204241098-s89a2jdmfjfbcmev4qgped8phnh971n2.apps.googleusercontent.com';

// Estado de la App
let S = {
    transactions: [],
    recurring: [],
    view: 'dashboard',
    month: new Date().getMonth(),
    cur: 'MXN',
    gdOk: false
};

// Intentar cargar datos locales para que no se vea negro mientras sincroniza
function loadLocal() {
    const saved = localStorage.getItem('diegofi_backup');
    if (saved) S = JSON.parse(saved);
    render();
}

function render() {
    const app = document.getElementById('app');
    
    // Si llegamos aquÃ­, la pantalla negra DEBE desaparecer
    app.innerHTML = `
        <div class="hdr">
            <div class="logo">DiegoFi</div>
            <button class="btn-sync" onclick="startSync()">
                ${S.gdOk ? 'ðŸŸ¢ Sincronizado' : 'âšª Conectar Drive'}
            </button>
        </div>

        <div class="cd">
            <div style="font-size:12px;color:var(--t5)">BALANCE DEL MES</div>
            <div style="font-size:28px;font-weight:800">$${calculateBalance().toLocaleString()}</div>
        </div>

        <div id="content">
            ${S.view === 'dashboard' ? renderDashboard() : renderRecurring()}
        </div>

        <div class="nav">
            <button class="nb ${S.view==='dashboard'?'on':''}" onclick="changeView('dashboard')">INICIO</button>
            <button class="nb ${S.view==='rec'?'on':''}" onclick="changeView('rec')">FIJOS</button>
        </div>
    `;
}

function renderDashboard() {
    return `
        <div class="cd">
            <div style="color:var(--gn)">Ingresos Semanales: $${calculateWeekly(true)}</div>
            <div style="color:var(--rd)">Gastos Semanales: $${calculateWeekly(false)}</div>
        </div>
        <p style="text-align:center;color:var(--t5)">Presiona el botÃ³n "+" para registrar.</p>
    `;
}

function renderRecurring() {
    return `<h3>Pagos Fijos</h3><p>PrÃ³ximamente...</p>`;
}

function calculateBalance() {
    return S.transactions.reduce((acc, t) => t.type === 'income' ? acc + t.amount : acc - t.amount, 0);
}

function calculateWeekly(isIncome) {
    return 0; // LÃ³gica simplificada para el test
}

function changeView(v) { S.view = v; render(); }

function startSync() {
    if (!googleLoaded) return alert("Cargando conexiÃ³n con Google... intenta en 5 segundos.");
    // AquÃ­ irÃ­a la lÃ³gica de Google que ya configuraste
    alert("Iniciando conexiÃ³n...");
}

// Iniciar
setTimeout(() => {
    loadLocal();
}, 500);

</script>
</body>
</html>
